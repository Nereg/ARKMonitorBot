# default docker-compose
services:
  # main python process
  bot:
    build: .
    depends_on:
      - db

  # postgres database
  db:
    image: postgres
    restart: always
    environment:
      POSTGRES_PASSWORD_FILE: /configs/dbPassword.secret
    volumes:
      - ./storage/db:/var/lib/postgresql/data # data storage
      - ./configs/:/configs/ # for configurations
  
  # grafana agent for metrics
  agent:
    image: grafana/agent:latest
    entrypoint:
      - /bin/agent
      - -config.file=/configs/grafanaAgent.yaml
    volumes:
      - ./configs/:/configs/

  # promtail:
  #   image: grafana/promtail:latest
  #   volumes:
  #     - ./logs:/bot_logs/
  #     - ./cfg:/cfg/
  #   command: -config.file=/cfg/promtail-config.yaml -print-config-stderr